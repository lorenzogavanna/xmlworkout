<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>QDomyos xml workout creator</title><style>@keyframes blink{0%{opacity:1}50%{opacity:0}100%{opacity:1}}body{font-family:Arial,sans-serif;background-color:#f7f9fc;font-size:14px;color:#333;margin:0;padding:20px;display:flex;justify-content:center;align-items:center;min-height:100vh}form{background:#fff;border:1px solid #dcdfe6;border-radius:8px;box-shadow:0 4px 6px rgba(0,0,0,.1);padding:20px 30px;width:100%;max-width:500px}.typesDiv{display:flex}.typeDiv{margin:1px;width:50%;border:solid 1px #000}.titleDiv{font-weight:700;margin-right:10px}label{font-weight:700;margin-right:10px}input[type=number],input[type=text],select{padding:8px;margin:5px 0;border:1px solid #dcdfe6;border-radius:4px;width:100%;max-width:100px}input[type=checkbox]{margin-right:5px}div.type-selector{margin-top:10px;margin-bottom:20px}select{padding:8px;margin:5px 0;border:1px solid #dcdfe6;border-radius:4px}button{background-color:#007bff;color:#fff;border:none;padding:10px 20px;border-radius:4px;cursor:pointer;margin:5px 2px;transition:background-color .3s ease}button:hover{background-color:#0056b3}button:disabled{background-color:#cbd3da;cursor:not-allowed}p#result{margin-top:20px;font-size:13px;color:#333;text-align:center;background-color:silver}@media (max-width:600px){form{padding:15px}label{display:block;margin-bottom:5px}input[type=number],input[type=text],select{width:100%}button{width:100%;margin:5px 0}}</style></head><body><form id="workout-form"><div><label>QDomyos xml Workout creator</label></div><label>Workout Title:</label><input id="title"><br><span>Row Type:</span><input type="radio" id="durationType" name="rowType" value="duration" onchange='changeType("durationDiv","distanceDiv")' checked="checked"><label for="durationType">Duration</label><input type="radio" id="distanceType" name="rowType" value="distance" onchange='changeType("distanceDiv","durationDiv")'><label for="distanceType">Distance</label><div class="type-selector" id="distanceDiv" style="display:none"><label for="distance">Distance (km)</label><input type="number" id="distance" name="distance" inputmode="numeric" oninput='ckMax("distance",100)' style="width:8ch" value="1"></div><div class="type-selector" id="durationDiv"><label for="hours">Duration</label><select id="hours" name="hours"><option disabled="disabled" selected="selected">00</option></select><span>:</span><select id="minutes" name="minutes"><option disabled="disabled" selected="selected">00</option></select><span>:</span><select id="seconds" name="seconds"><option disabled="disabled" selected="selected">01</option></select></div><input type="checkbox" id="ckPid" name="ckPid" onchange='tgHide("pid")'><label for="ckPid">Pid (zone hr 1-5)</label><select id="pid" name="pid" style="visibility:hidden" onchange='colorOptionBox("pid")'><option id="pid_0" value="0" style="background-color:#fff">0</option><option id="pid_1" value="1" style="background-color:#9bc2e6">1</option><option id="pid_2" selected="selected" value="2" style="background-color:#a9d08e">2</option><option id="pid_3" value="3" style="background-color:#ffff8b">3</option><option id="pid_4" value="4" style="background-color:#ff8a33">4</option><option id="pid_5" value="5" style="background-color:#ff4f4f">5</option></select><div class="typesDiv"><div id="runDiv" class="typeDiv"><div class="titleDiv">Run</div><input type="checkbox" id="ckPowerzone" name="ckPowerzone" onchange='tgHide("powerzone")'><label for="ckPowerzone">Powerzone</label><select id="powerzone" class="powerzone" name="powerzone" style="visibility:hidden" onchange='colorOptionBox("powerzone")'><option id="powerzone_1" value="1" style="background-color:#d0cece">Z1</option><option id="powerzone_2" value="2" style="background-color:#9bc2e6" selected="selected">Z2</option><option id="powerzone_3" value="3" style="background-color:#a9d08e">Z3</option><option id="powerzone_4" value="4" style="background-color:#ffff8b">Z4</option><option id="powerzone_5" value="5" style="background-color:#ff8a33">Z5</option><option id="powerzone_6" value="6" style="background-color:#ff4f4f">Z6</option></select><br><input type="checkbox" id="ckSpeed" name="ckSpeed" onchange='tgHide("speed")'><label for="ckSpeed">Speed (km/h)</label><input type="number" id="speed" name="speed" min="0.1" inputmode="numeric" oninput='ckMax("speed",100)' style="width:4ch;visibility:hidden" value="7"><br><input type="checkbox" id="ckMaxSpeed" name="ckMaxSpeed" onchange='tgHide("maxspeed")'><label for="ckMaxSpeed">Max Speed (km/h)</label><input type="number" id="maxspeed" name="maxspeed" min="1" inputmode="numeric" oninput='ckMax("maxspeed",100)' style="width:4ch;visibility:hidden" value="12"><br><input type="checkbox" id="ckInclination" name="ckInclination" onchange='tgHide("inclination")'><label for="ckInclination">Incline</label><input type="number" id="inclination" name="inclination" inputmode="numeric" oninput='ckMax("inclination",100)' style="width:4ch;visibility:hidden" value="0"><br><input type="checkbox" id="ckFanspeed" name="ckFanspeed" onchange='tgHide("fanspeed")'><label for="ckFanspeed">Fanspeed</label><input type="number" id="fanspeed" name="fanspeed" min="1" inputmode="numeric" oninput='ckMax("fanspeed",100)' style="width:4ch;visibility:hidden" value="0"><br><input type="checkbox" id="ckRamp" name="ckRamp" onchange='tgHide("rampsDiv","rampfrom","rampto")'><label for="ckRamp">Ramp</label><input type="number" id="rampfrom" name="rampfrom" min="0" inputmode="numeric" oninput='ckMax("rampfrom",100)' style="width:7ch;visibility:hidden" value="0"> <input type="number" id="rampto" name="rampto" min="0" inputmode="numeric" oninput='ckMax("rampto",100)' style="width:7ch;visibility:hidden" value="0"><br><div id="rampsDiv" style="visibility:hidden"><div style="display:flex;align-items:center;margin-bottom:5px"><input type="radio" id="powerzoneramp" name="ramps" value="powerzoneramp" checked="checked"><label for="powerzoneramp">Powerzone %</label></div><div style="display:flex;align-items:center;margin-bottom:5px"><input type="radio" id="speedramp" name="ramps" value="speedramp"><label for="speedramp">Speed</label></div></div></div><div id="bikeDiv" class="typeDiv"><div class="titleDiv">Bike</div><input type="checkbox" id="ckCadence" name="ckCadence" onchange='tgHide("cadence")'><label for="ckCadence">Cadence (rpm)</label><input type="number" id="cadence" name="cadence" min="1" inputmode="numeric" oninput='ckMax("cadence",300)' style="width:4ch;visibility:hidden" value="0"><br><input type="checkbox" id="ckResistance" name="ckResistance" onchange='tgHide("resistance")'><label for="ckResistance">Resistance</label><input type="number" id="resistance" name="resistance" min="1" inputmode="numeric" oninput='ckMax("resistance",300)' style="width:4ch;visibility:hidden" value="0"><br><input type="checkbox" id="ckPelotonResistance" name="ckPelotonResistance" onchange='tgHide("requested_peloton_resistance")'><label for="ckPelotonResistance">Peloton Resistance</label><input type="number" id="requested_peloton_resistance" name="requested_peloton_resistance" min="1" inputmode="numeric" oninput='ckMax("requested_peloton_resistance",300)' style="width:4ch;visibility:hidden" value="0"></div></div><label for="repeats">Repeats</label><input type="number" id="repeats" name="repeats" min="1" inputmode="numeric" style="width:4ch" value="3"><button type="button" id="startInterval" onclick="startIntervals()">Start Interval</button><br><br><button type="button" onclick="addRow()">Add row</button><button type="button" onclick="resetRow()">Reset</button><button type="button" id="undo" onclick="undoLastRow()">Remove last row</button><button type="button" id="download" onclick="downloadXML()">Download XML</button><p class="resultbox" id="result"></p></form><script>colorOptionBox("power");
            colorOptionBox("pid");
            let str;
            let str1 = `\n` + "<row ";
            function colorOptionBox(kind) {
                log(kind);
                if ((kind = "pid")) {
                    log("pid");
                    const select = document.getElementById("pid");
                    const selectedValue = select.value;
                    // Define color mapping
                    const colorMap = {
                        "0": "#ffffff",
                        "1": "#9bc2e6",
                        "2": "#a9d08e", // Default for Z2
                        "3": "#ffff8b",
                        "4": "#ff8a33",
                        "5": "#ff8a33",
                    };
                    select.style.backgroundColor = colorMap[selectedValue];
                }
                if ((kind = "power")) {
                    const select = document.getElementById("powerzone");
                    const selectedValue = select.value;
                    // Define color mapping
                    const colorMap = {
                        "1": "#d0cece",
                        "2": "#9bc2e6", // Default for Z2
                        "3": "#a9d08e",
                        "4": "#ffff8b",
                        "5": "#ff8a33",
                        "6": "#ff4f4f",
                    };

                    select.style.backgroundColor = colorMap[selectedValue];
                }
                kind = "";
            }
            function startIntervals() {
                log(document.getElementById("startInterval").textContent);
                if (document.getElementById("startInterval").textContent == "Start Interval") {
                    document.getElementById("startInterval").style.animation = "blink 2s infinite";
                    document.getElementById("startInterval").style.backgroundColor = "#F67280";
                    document.getElementById("startInterval").textContent = "Close Interval";
                    document.getElementById("result").innerText += `\n` + '<repeat times="' + document.getElementById("repeats").value + '">';
                } else {
                    document.getElementById("startInterval").style.animation = "none";
                    document.getElementById("startInterval").textContent = "Start Interval";
                    document.getElementById("startInterval").style.backgroundColor = "";
                    document.getElementById("result").innerText += `\n` + "</repeat>";
                }
            }

            function downloadXML() {
                if (document.getElementById("startInterval").textContent != "Start Interval") {
                    alert("Close the repeat before the download!");
                } else {
                    const str0 = '<?xml version="1.0" encoding="UTF-8"?>' + `\n` + "<rows>" + `\n`;
                    const xmlContent = str0 + document.getElementById("result").innerText + `\n` + `\n` + "</rows>";
                    const blob = new Blob([xmlContent], { type: "application/xml" });
                    const a = document.createElement("a");
                    a.href = URL.createObjectURL(blob);
                    if (document.getElementById("title").value) {
                        a.download = document.getElementById("title").value + ".xml";
                    } else {
                        a.download = "workout.xml"; // Default file name
                    }
                    a.click();
                    URL.revokeObjectURL(a.href);
                }
            }

            function resetRow() {
                if (document.getElementById("startInterval").textContent != "Start Interval") {
                    document.getElementById("startInterval").style.animation = "none";
                    document.getElementById("startInterval").textContent = "Start Interval";
                    document.getElementById("startInterval").style.backgroundColor = "";
                }
                str = "";
                document.getElementById("result").innerText = "";
            }

            function tgHide(idTg1, idTg2, idTg3) {
                let myEl1 = document.getElementById(idTg1);
                let myEl2 = document.getElementById(idTg2);
                let myEl3 = document.getElementById(idTg3);
                if (myEl1.style.visibility == "hidden") {
                    myEl1.style.visibility = "visible";
                } else {
                    myEl1.style.visibility = "hidden";
                }
                if (myEl2.style.visibility == "hidden") {
                    myEl2.style.visibility = "visible";
                } else {
                    myEl2.style.visibility = "hidden";
                }
                if (myEl3.style.visibility == "hidden") {
                    myEl3.style.visibility = "visible";
                } else {
                    myEl3.style.visibility = "hidden";
                }
            }

            function changeType(idShow, idHide) {
                let myElShow = document.getElementById(idShow);
                let myElHide = document.getElementById(idHide);
                if (myElShow.style.display == "none") {
                    myElShow.style.display = "";
                    myElHide.style.display = "none";
                }
            }

            function populateSelect(id, max) {
                const select = document.getElementById(id);
                for (let i = 0; i <= max; i++) {
                    const option = document.createElement("option");
                    option.value = i;
                    option.textContent = i.toString().padStart(2, "0");
                    select.appendChild(option);
                }
            }
            populateSelect("hours", 8); // Hours: 0-8
            populateSelect("minutes", 59); // Minutes: 0-59
            populateSelect("seconds", 59); // Seconds: 0-59
            populateSelect("distance", 100); // Distance km: 0-100

            function addRow() {
                //str += document.getElementById('result').innerText;
                if (document.getElementById("durationType").checked) {
                    //duration type
                    const hours = document.getElementById("hours").value;
                    const minutes = document.getElementById("minutes").value;
                    const seconds = document.getElementById("seconds").value;

                    if (hours && minutes && seconds) {
                        str = str1 + 'duration="' + `${hours.padStart(2, "0")}:${minutes.padStart(2, "0")}:${seconds.padStart(2, "0")}` + '"';
                    } else {
                        alert("Please select hours, minutes, and seconds.");
                    }
                } else {
                    //distance type
                    const distance = document.getElementById("distance").value;
                    str = "";
                    str = str1 + 'distance="' + distance + '"';
                }
                if (document.getElementById("ckPid").checked) {
                    str += ' zonehr="' + document.getElementById("pid").value + '"';
                }
                if (document.getElementById("ckSpeed").checked) {
                    str += ' speed="' + document.getElementById("speed").value + '"';
                }
                if (document.getElementById("ckMaxSpeed").checked) {
                    str += ' maxspeed="' + document.getElementById("maxspeed").value + '"';
                }
                if (document.getElementById("ckInclination").checked) {
                    str += ' inclination="' + document.getElementById("inclination").value + '"';
                }
                if (document.getElementById("ckFanspeed").checked) {
                    str += ' fanspeed="' + document.getElementById("fanspeed").value + '"';
                }
                if (document.getElementById("ckCadence").checked) {
                    str += ' cadence="' + document.getElementById("cadence").value + '"';
                }
                if (document.getElementById("ckResistance").checked) {
                    str += ' resistance="' + document.getElementById("resistance").value + '"';
                }
                if (document.getElementById("ckPelotonResistance").checked) {
                    str += ' requested_peloton_resistance="' + document.getElementById("requested_peloton_resistance").value + '"';
                }
                if (document.getElementById("ckRamp").checked) {
                    if (document.getElementById("powerzoneramp").checked) {
                        str += ' powerzonefrom="' + document.getElementById("rampfrom").value + '"' + ' powerzoneto="' + document.getElementById("rampto").value + '"';
                    } else if (document.getElementById("speedramp").checked) {
                        str += ' speedfrom="' + document.getElementById("rampfrom").value + '"' + ' speedto="' + document.getElementById("rampto").value + '"';
                    }
                }

                if (document.getElementById("ckPowerzone").checked) {
                    document.getElementById("powerzone").value;

                    const powerZones = {
                        1: [0.4, 0.59],
                        2: [0.6, 0.75],
                        3: [0.76, 0.89],
                        4: [0.9, 1.04],
                        5: [1.05, 1.18],
                        6: [1.19, 1.3],
                    };
                    const lastZone = document.getElementById("powerzone").value;
                    const pzone = randomInRange(powerZones[lastZone]);
                    str += ' powerzone="' + pzone + '"';
                }
                str += ' forcespeed="1"/>';
                document.getElementById("result").innerText += str;
            }
            function randomInRange([min, max]) {
                return (Math.random() * (max - min) + min).toFixed(2);
            }

            function ckMax(id, max) {
                if (document.getElementById(id).value > max) {
                    document.getElementById(id).value = max;
                }
            }

            function undoLastRow() {
                let currentText = document.getElementById("result").innerText;
                let lines = currentText.split("\n");
                let lastLine = lines[lines.length - 1];
                lines.pop();
                let updatedText = lines.join("\n");
                document.getElementById("result").innerText = updatedText;
                if (lastLine == "</repeat>") {
                    document.getElementById("startInterval").style.animation = "blink 2s infinite";
                    document.getElementById("startInterval").style.backgroundColor = "#F67280";
                    document.getElementById("startInterval").textContent = "Close Interval";
                } else {
                    document.getElementById("startInterval").style.animation = "none";
                    document.getElementById("startInterval").style.backgroundColor = "";
                    document.getElementById("startInterval").textContent = "Start Interval";
                }
            }

            function validateNumberInput(input) {
                // Allow only numbers and a single decimal point
                let value = input.value;

                // Remove all characters except numbers and decimal points
                value = value.replace(/[^\d.]/g, "");

                // Ensure only two decimal point
                const decimalCount = (value.match(/\./g) || []).length;
                if (decimalCount > 2) {
                    value = value.replace(/\.(?=.*\.)/g, "");
                }

                // Get the min and max values
                const minValue = input.getAttribute("min") ? parseFloat(input.getAttribute("min")) : 0;
                const maxValue = input.getAttribute("data-max") ? parseFloat(input.getAttribute("data-max")) : Infinity;

                // Convert to number
                let numValue = parseFloat(value);

                // If empty or invalid, set to minimum value
                if (isNaN(numValue) || value === "") {
                    numValue = minValue;
                }

                // Ensure value is within bounds
                numValue = Math.max(minValue, Math.min(numValue, maxValue));

                // Update input with validated value, preserve decimal input
                input.value = value === "" ? minValue : value;
            }

            function initializeNumberInputs() {
                const numberInputs = document.querySelectorAll('input[type="number"]');
                numberInputs.forEach((input) => {
                    // Set initial value if empty
                    if (input.value === "") {
                        const minValue = input.getAttribute("min") ? parseFloat(input.getAttribute("min")) : 0;
                        input.value = minValue;
                    }

                    // Remove the pattern attribute as it restricts to integers only
                    input.removeAttribute("pattern");

                    // Add event listeners
                    input.addEventListener("input", () => validateNumberInput(input));
                    input.addEventListener("blur", () => validateNumberInput(input));
                    // Prevent empty value on form submission
                    input.form?.addEventListener("submit", () => validateNumberInput(input));
                });
            }

            // Initialize validation when the document loads
            document.addEventListener("DOMContentLoaded", initializeNumberInputs);

            // Update the existing ckMax function
            function ckMax(id, max) {
                const input = document.getElementById(id);
                input.setAttribute("data-max", max);
                validateNumberInput(input);
            }

            function log(a, b, c, d, e, f, g, h, i) {
                //for 9 log prints
                console.log(...[a, b, c, d, e, f, g, h, i].filter((value) => value !== undefined));
            }</script></body></html>